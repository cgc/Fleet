\hypertarget{_builtins_8h}{}\doxysection{src/\+Virtual\+Machine/\+Builtins.h File Reference}
\label{_builtins_8h}\index{src/VirtualMachine/Builtins.h@{src/VirtualMachine/Builtins.h}}


The \mbox{\hyperlink{class_builtin}{Builtin}} type just stores a function pointer and an Op command. This makes it a bit handier to define Primitives because they all take this form.  


{\ttfamily \#include \char`\"{}Numerics.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}I\+O.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Errors.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Primitive.\+h\char`\"{}}\newline
Include dependency graph for Builtins.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_builtins_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_builtins_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
 \mbox{\hyperlink{namespace_builtins}{Builtins}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}}~+\mbox{[}$\,$\mbox{]}(typename Grammar\+\_\+t\+::\+Virtual\+Machine\+State\+\_\+t$\ast$ vms, int arg) -\/$>$ void
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ typename Grammar\+\_\+t\+::input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_ad0f8dca506b7edd9031095025dd2e258}{Builtins\+::X}} (Op\+::X, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(!vms-\/$>$xstack.\+empty());vms-\/$>$template push$<$ typename Grammar\+\_\+t\+::input\+\_\+t $>$(vms-\/$>$xstack.\+top());\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ bool, bool, bool $>$ \mbox{\hyperlink{namespace_builtins_a52744e50ca0efe422f650bb2e0984034}{Builtins\+::\+And}} (Op\+::\+And, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ bool b=vms-\/$>$template getpop$<$ bool $>$();if(!b) \{ vms-\/$>$program.\+popn(arg);vms-\/$>$template push$<$ bool $>$(false);\} else \{ \} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ bool, bool, bool $>$ \mbox{\hyperlink{namespace_builtins_a8032519b3fc12f628351116f0eb22a79}{Builtins\+::\+Or}} (Op\+::\+Or, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ bool b=vms-\/$>$template getpop$<$ bool $>$();if(b) \{ vms-\/$>$program.\+popn(arg);vms-\/$>$template push$<$ bool $>$(true);\} else \{ \} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ bool, bool $>$ \mbox{\hyperlink{namespace_builtins_ab48e0d43bcf71fcc87e923b1d1adea5d}{Builtins\+::\+Not}} (Op\+::\+Not, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ vms-\/$>$push(not vms-\/$>$template getpop$<$ bool $>$());\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename T $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ T, bool, T, T $>$ \mbox{\hyperlink{namespace_builtins_a41d4ede335cf73863bdf781f4ce1bf3f}{Builtins\+::\+If}} (Op\+::\+If, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ bool b=vms-\/$>$template getpop$<$ bool $>$();if(!b) vms-\/$>$program.\+popn(arg);else \{\};\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}} \mbox{\hyperlink{namespace_builtins_a973e141df2c749b85956bc9ddca970fc}{Builtins\+::\+Jmp}} (Op\+::\+Jmp, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ vms-\/$>$program.\+popn(arg);\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}} \mbox{\hyperlink{namespace_builtins_a0a0d24fe957349840876c9ac3f1d6464}{Builtins\+::\+PopX}} (Op\+::\+PopX, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ vms-\/$>$xstack.\+pop();\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ bool $>$ \mbox{\hyperlink{namespace_builtins_a6888aa01e830dbc435af2316c2c74f0e}{Builtins\+::\+Flip}} (Op\+::\+Flip, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$pool !=nullptr);vms-\/$>$pool-\/$>$copy\+\_\+increment\+\_\+push(vms, true, -\/\mbox{\hyperlink{_numerics_8h_a1cab50ac2cae826eca1b03bb33eae1f1}{L\+O\+G2}});bool b=vms-\/$>$pool-\/$>$increment\+\_\+push(vms, false, -\/\mbox{\hyperlink{_numerics_8h_a1cab50ac2cae826eca1b03bb33eae1f1}{L\+O\+G2}});if(b) \{ vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a62e4b4888c0e06f92db375155a5f5460}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+C\+E\+\_\+\+N\+O\+\_\+\+D\+E\+L\+E\+TE}};\} else \{ vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a1a2e4f5a61984625db01a97518e16974}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+CE}};\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ bool, double $>$ \mbox{\hyperlink{namespace_builtins_aae2d39a107a794003d023715f6610f96}{Builtins\+::\+FlipP}} (Op\+::\+FlipP, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$pool !=nullptr);double p=vms-\/$>$template getpop$<$ double $>$();if(std\+::isnan(p)) \{ p=0.\+0;\} if(p $>$ 1.\+0 or p$<$ 0.\+0) \{ \mbox{\hyperlink{_i_o_8h_a5e727e0c710d35259cfee7d2e8722dd5}{P\+R\+I\+N\+TN}}(\char`\"{}$\ast$$\ast$$\ast$ Error, received p not in \mbox{[}0,1\mbox{]}\+:\char`\"{}, p);assert(false);\} vms-\/$>$pool-\/$>$copy\+\_\+increment\+\_\+push(vms, true, log(p));bool b=vms-\/$>$pool-\/$>$increment\+\_\+push(vms, false, log(1.\+0-\/p));if(b) \{ vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a62e4b4888c0e06f92db375155a5f5460}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+C\+E\+\_\+\+N\+O\+\_\+\+D\+E\+L\+E\+TE}};\} else \{ vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a1a2e4f5a61984625db01a97518e16974}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+CE}};\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ bool, double $>$ \mbox{\hyperlink{namespace_builtins_a467be9c940565b464234b395389aacb7}{Builtins\+::\+Safe\+FlipP}} (Op\+::\+Safe\+FlipP, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$pool !=nullptr);double p=vms-\/$>$template getpop$<$ double $>$();if(std\+::isnan(p)) p=0.\+0;else if(p $>$ 1.\+0) p=1.\+0;else if(p$<$ 0.\+0) p=0.\+0;vms-\/$>$pool-\/$>$copy\+\_\+increment\+\_\+push(vms, true, log(p));bool b=vms-\/$>$pool-\/$>$increment\+\_\+push(vms, false, log(1.\+0-\/p));if(b) \{ vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a62e4b4888c0e06f92db375155a5f5460}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+C\+E\+\_\+\+N\+O\+\_\+\+D\+E\+L\+E\+TE}};\} else \{ vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a1a2e4f5a61984625db01a97518e16974}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+CE}};\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename t , typename T  = std\+::set$<$t$>$$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ t, T $>$ \mbox{\hyperlink{namespace_builtins_ab2ec850110ac1149c73a9408a1bb950a}{Builtins\+::\+Sample}} (Op\+::\+Sample, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ auto s=vms-\/$>$template getpop$<$ T $>$();if(s.\+size()==1) \{ auto v=std\+::move($\ast$s.\+begin());vms-\/$>$template push$<$ t $>$(std\+::move(v));\} else \{ const double lp=-\/log(s.\+size());for(const auto \&x \+:s) \{ bool b=vms-\/$>$pool-\/$>$copy\+\_\+increment\+\_\+push(vms, x, lp);if(not b) break;\} vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a1a2e4f5a61984625db01a97518e16974}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+CE}};\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ int, int $>$ \mbox{\hyperlink{namespace_builtins_accdefd925ab335a23128914646319190}{Builtins\+::\+Sample\+\_\+int}} (\mbox{\hyperlink{_ops_8h_a588e6b56097e045c733b60d25c4d45abac5dd1b2697720fe692c529688d3f4f8d}{Op\+::\+Sample}}, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ const int mx=vms-\/$>$template getpop$<$ int $>$();const double lp=-\/log(mx);for(int i=0;i$<$ mx;i++) \{ bool b=vms-\/$>$pool-\/$>$copy\+\_\+increment\+\_\+push(vms, i, lp);if(not b) break;\} vms-\/$>$status=\mbox{\hyperlink{_v_m_status_8h_a6202215407ab29590bb936ca2996cf64a1a2e4f5a61984625db01a97518e16974}{vmstatus\+\_\+t\+::\+R\+A\+N\+D\+O\+M\+\_\+\+C\+H\+O\+I\+CE}};\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename key\+\_\+t , typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}} \mbox{\hyperlink{namespace_builtins_a41afa777e99c28cbf1ac3501464ba8e9}{Builtins\+::\+Mem}} (Op\+::\+Mem, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ auto memindex=vms-\/$>$template memstack$<$ key\+\_\+t $>$().top();vms-\/$>$template memstack$<$ key\+\_\+t $>$().pop();if(vms-\/$>$template mem$<$ key\+\_\+t $>$().\mbox{\hyperlink{_strings_8h_ae6eafa3700b097b96c1601a141a45de4}{count}}(memindex)==0) \{ vms-\/$>$template mem$<$ key\+\_\+t $>$()\mbox{[}memindex\mbox{]}=vms-\/$>$template gettop$<$ output\+\_\+t $>$();\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t $>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}} \mbox{\hyperlink{namespace_builtins_a49c7eea2f0420591809f9d4470baccfb}{Builtins\+::\+No\+Op}} (Op\+::\+No\+Op, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_a51eb98277802b2cb3cb6e246b2dfd2cb}{Builtins\+::\+Recurse}} (Op\+::\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$program.\+loader !=nullptr);if(vms-\/$>$recursion\+\_\+depth++$>$ vms-\/$>$M\+A\+X\+\_\+\+R\+E\+C\+U\+R\+SE) \{ throw \mbox{\hyperlink{class_v_m_s_runtime_error}{V\+M\+S\+Runtime\+Error}}();\} auto mynewx=vms-\/$>$template getpop$<$ input\+\_\+t $>$();vms-\/$>$xstack.\+push(std\+::move(mynewx));vms-\/$>$program.\+push(\mbox{\hyperlink{namespace_builtins_a0a0d24fe957349840876c9ac3f1d6464}{Builtins\+::\+PopX}}$<$ Grammar\+\_\+t $>$.make\+Instruction());vms-\/$>$program.\+loader-\/$>$push\+\_\+program(vms-\/$>$program);\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_a94cef1f6b9555a28914c897e5bc50654}{Builtins\+::\+Safe\+Recurse}} (Op\+::\+Safe\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(not vms-\/$>$template stack$<$ input\+\_\+t $>$().empty());if(vms-\/$>$template stack$<$ input\+\_\+t $>$().top().size()==0) \{ vms-\/$>$template getpop$<$ input\+\_\+t $>$();vms-\/$>$template push$<$ output\+\_\+t $>$(output\+\_\+t\{\});\} else \{ Recurse$<$ Grammar\+\_\+t $>$.call(vms, arg);\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_a4755b55bacb9357deefb65240d7bbc8b}{Builtins\+::\+Mem\+Recurse}} (Op\+::\+Mem\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$program.\+loader !=nullptr);using mykey\+\_\+t=short;if(vms-\/$>$recursion\+\_\+depth++$>$ vms-\/$>$M\+A\+X\+\_\+\+R\+E\+C\+U\+R\+SE) \{ throw \mbox{\hyperlink{class_v_m_s_runtime_error}{V\+M\+S\+Runtime\+Error}}();\} auto x=vms-\/$>$template getpop$<$ input\+\_\+t $>$();auto memindex=std\+::make\+\_\+pair(arg, x);if(vms-\/$>$template mem$<$ mykey\+\_\+t $>$().\mbox{\hyperlink{_strings_8h_ae6eafa3700b097b96c1601a141a45de4}{count}}(memindex))\{ vms-\/$>$push(vms-\/$>$template mem$<$ mykey\+\_\+t $>$()\mbox{[}memindex\mbox{]});\} else \{ vms-\/$>$xstack.\+push(x);vms-\/$>$program.\+push(\mbox{\hyperlink{namespace_builtins_a0a0d24fe957349840876c9ac3f1d6464}{Builtins\+::\+PopX}}$<$ Grammar\+\_\+t $>$.make\+Instruction());vms-\/$>$template memstack$<$ mykey\+\_\+t $>$().push(memindex);vms-\/$>$program.\+push(\mbox{\hyperlink{namespace_builtins_a41afa777e99c28cbf1ac3501464ba8e9}{Builtins\+::\+Mem}}$<$ Grammar\+\_\+t, mykey\+\_\+t, output\+\_\+t $>$.make\+Instruction());vms-\/$>$program.\+loader-\/$>$push\+\_\+program(vms-\/$>$program);\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_ae8ce69cb887ec1cbfc50cf9e8c721548}{Builtins\+::\+Safe\+Mem\+Recurse}} (Op\+::\+Safe\+Mem\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(not vms-\/$>$template stack$<$ input\+\_\+t $>$().empty());if(vms-\/$>$template stack$<$ input\+\_\+t $>$().top().size()==0) \{ vms-\/$>$template getpop$<$ input\+\_\+t $>$();vms-\/$>$template push$<$ output\+\_\+t $>$(output\+\_\+t\{\});\} else \{ Mem\+Recurse$<$ Grammar\+\_\+t $>$.call(vms, arg);\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename key\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, key\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_a636952e2b893e683faedbb90308828ff}{Builtins\+::\+Lexicon\+Recurse}} (Op\+::\+Lexicon\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$program.\+loader !=nullptr);if(vms-\/$>$recursion\+\_\+depth++$>$ vms-\/$>$M\+A\+X\+\_\+\+R\+E\+C\+U\+R\+SE) \{ throw \mbox{\hyperlink{class_v_m_s_runtime_error}{V\+M\+S\+Runtime\+Error}}();\} auto key=vms-\/$>$template getpop$<$ key\+\_\+t $>$();auto mynewx=vms-\/$>$template getpop$<$ input\+\_\+t $>$();vms-\/$>$xstack.\+push(std\+::move(mynewx));vms-\/$>$program.\+push(\mbox{\hyperlink{namespace_builtins_a0a0d24fe957349840876c9ac3f1d6464}{Builtins\+::\+PopX}}$<$ Grammar\+\_\+t $>$.make\+Instruction());vms-\/$>$program.\+loader-\/$>$push\+\_\+program(vms-\/$>$program, key);\})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename key\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, key\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_a2f51aebf13fc33d9e69468eb1e6593d1}{Builtins\+::\+Lexicon\+Safe\+Recurse}} (Op\+::\+Lexicon\+Safe\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(not vms-\/$>$template stack$<$ input\+\_\+t $>$().empty());assert(vms-\/$>$program.\+loader !=nullptr);if(vms-\/$>$template stack$<$ input\+\_\+t $>$().top().size()==0) \{ vms-\/$>$template getpop$<$ key\+\_\+t $>$();vms-\/$>$template getpop$<$ input\+\_\+t $>$();vms-\/$>$template push$<$ output\+\_\+t $>$(output\+\_\+t\{\});\} else \{ Lexicon\+Recurse$<$ Grammar\+\_\+t, key\+\_\+t $>$.call(vms, arg);\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename key\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, key\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_a17e28043215d4d213d2e96a4d7416a9c}{Builtins\+::\+Lexicon\+Mem\+Recurse}} (Op\+::\+Lexicon\+Mem\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(vms-\/$>$program.\+loader !=nullptr);if(vms-\/$>$recursion\+\_\+depth++$>$ vms-\/$>$M\+A\+X\+\_\+\+R\+E\+C\+U\+R\+SE) \{ throw \mbox{\hyperlink{class_v_m_s_runtime_error}{V\+M\+S\+Runtime\+Error}}();\} auto key=vms-\/$>$template getpop$<$ key\+\_\+t $>$();auto x=vms-\/$>$template getpop$<$ input\+\_\+t $>$();auto memindex=std\+::make\+\_\+pair(key, x);if(vms-\/$>$template mem$<$ key\+\_\+t $>$().\mbox{\hyperlink{_strings_8h_ae6eafa3700b097b96c1601a141a45de4}{count}}(memindex))\{ vms-\/$>$push(vms-\/$>$template mem$<$ key\+\_\+t $>$()\mbox{[}memindex\mbox{]});\} else \{ vms-\/$>$xstack.\+push(x);vms-\/$>$program.\+push(\mbox{\hyperlink{namespace_builtins_a0a0d24fe957349840876c9ac3f1d6464}{Builtins\+::\+PopX}}$<$ Grammar\+\_\+t $>$.make\+Instruction());vms-\/$>$template memstack$<$ key\+\_\+t $>$().push(memindex);vms-\/$>$program.\+push(\mbox{\hyperlink{namespace_builtins_a41afa777e99c28cbf1ac3501464ba8e9}{Builtins\+::\+Mem}}$<$ Grammar\+\_\+t, key\+\_\+t, output\+\_\+t $>$.make\+Instruction());vms-\/$>$program.\+loader-\/$>$push\+\_\+program(vms-\/$>$program, key);\} \})
\item 
{\footnotesize template$<$typename Grammar\+\_\+t , typename key\+\_\+t , typename input\+\_\+t  = typename Grammar\+\_\+t\+::input\+\_\+t, typename output\+\_\+t  = typename Grammar\+\_\+t\+::output\+\_\+t$>$ }\\\mbox{\hyperlink{struct_primitive}{Primitive}}$<$ output\+\_\+t, key\+\_\+t, input\+\_\+t $>$ \mbox{\hyperlink{namespace_builtins_ab9990f6f6dbba65ec6517b50b13986d6}{Builtins\+::\+Lexicon\+Safe\+Mem\+Recurse}} (Op\+::\+Lexicon\+Safe\+Mem\+Recurse, \mbox{\hyperlink{_builtins_8h_ad05e94221ff2967761018674d5cbb960}{B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA}} \{ assert(not vms-\/$>$template stack$<$ input\+\_\+t $>$().empty());assert(vms-\/$>$program.\+loader !=nullptr);if(vms-\/$>$template stack$<$ input\+\_\+t $>$().top().size()==0) \{ vms-\/$>$template getpop$<$ key\+\_\+t $>$();vms-\/$>$template getpop$<$ input\+\_\+t $>$();vms-\/$>$template push$<$ output\+\_\+t $>$(output\+\_\+t\{\});\} else \{ Lexicon\+Mem\+Recurse$<$ Grammar\+\_\+t, key\+\_\+t $>$.call(vms, arg);\} \})
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The \mbox{\hyperlink{class_builtin}{Builtin}} type just stores a function pointer and an Op command. This makes it a bit handier to define Primitives because they all take this form. 



\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{_builtins_8h_ad05e94221ff2967761018674d5cbb960}\label{_builtins_8h_ad05e94221ff2967761018674d5cbb960}} 
\index{Builtins.h@{Builtins.h}!BUILTIN\_LAMBDA@{BUILTIN\_LAMBDA}}
\index{BUILTIN\_LAMBDA@{BUILTIN\_LAMBDA}!Builtins.h@{Builtins.h}}
\doxysubsubsection{\texorpdfstring{BUILTIN\_LAMBDA}{BUILTIN\_LAMBDA}}
{\footnotesize\ttfamily \#define B\+U\+I\+L\+T\+I\+N\+\_\+\+L\+A\+M\+B\+DA~+\mbox{[}$\,$\mbox{]}(typename Grammar\+\_\+t\+::\+Virtual\+Machine\+State\+\_\+t$\ast$ vms, int arg) -\/$>$ void}

